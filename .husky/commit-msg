#!/usr/bin/env sh

echo "ğŸ” Running commit message validation and pre-commit checks..."

# First run commitlint to validate commit message (if Node environment exists)
if command -v node >/dev/null 2>&1 && [ -d "frontend/node_modules" ]; then
    echo "ğŸ“ Validating commit message format..."
    cd frontend && pnpm exec commitlint --config commitlint.config.js --edit "$1"

    # If commitlint validation fails, exit
    if [ $? -ne 0 ]; then
        echo "âŒ Commit message validation failed. Please check the format and try again."
        exit 1
    fi
else
    echo "âš ï¸  Node.js environment not found, skipping commit message validation..."
fi

# Then run pre-commit hooks to check code quality
echo "ğŸ”§ Running pre-commit hooks..."
uv run pre-commit run --all-files

# If pre-commit fails, block the commit
if [ $? -ne 0 ]; then
    echo "âŒ Pre-commit hooks failed. Please fix the issues and try again."
    exit 1
fi

echo "âœ… All checks passed! Ready to commit."
